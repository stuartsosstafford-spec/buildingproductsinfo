---
import BaseLayout from '@/layouts/BaseLayout.astro';
import ProductGrid from '@/components/ProductGrid.astro';
import { categories } from '@/lib/categories';
import { getCollection } from 'astro:content';

const allProducts = await getCollection('products', ({ data }) => !data.draft);
const latestProducts = allProducts
  .sort((a, b) => b.data.addedDate.getTime() - a.data.addedDate.getTime())
  .slice(0, 6);

const featuredProducts = allProducts
  .filter((p) => p.data.featured)
  .slice(0, 3);

const allBrands = await getCollection('brands', ({ data }) => !data.draft);
---
<BaseLayout
  title="Building & Trade Product Information"
  description="Independent building and trade product information, specifications, and buying guides for professionals and serious DIYers across the UK."
>
  <section class="hero-section">
    <div class="container">
      <img src="/images/hero-banner.svg" alt="Building Products Info â€” Independent product information, specifications and buying guides for UK building and trade professionals" class="hero-banner" width="1200" height="300" />
    </div>
  </section>

  <section class="home-section">
    <div class="container">
      <div class="section-heading">
        <h2>Browse by Category</h2>
      </div>
      <div class="category-grid">
        {categories.map((cat) => (
          <a href={`/${cat.slug}/`} class="category-card">
            <div class="category-card-icon">{cat.icon}</div>
            <div class="category-card-label">{cat.label}</div>
          </a>
        ))}
      </div>
    </div>
  </section>

  {latestProducts.length > 0 && (
    <section class="home-section">
      <div class="container">
        <div class="section-heading">
          <h2>Latest Products</h2>
          <a href="/tools/">View all &rarr;</a>
        </div>
        <ProductGrid products={latestProducts.map((p) => ({
          title: p.data.title,
          slug: p.slug,
          category: p.data.category,
          brand: p.data.brand,
          shortDescription: p.data.shortDescription,
          featuredImage: p.data.featuredImage,
          affiliateUrl: p.data.affiliateUrl,
        }))} />
      </div>
    </section>
  )}

  {featuredProducts.length > 0 && (
    <section class="home-section">
      <div class="container">
        <div class="section-heading">
          <h2>Featured Products</h2>
        </div>
        <ProductGrid products={featuredProducts.map((p) => ({
          title: p.data.title,
          slug: p.slug,
          category: p.data.category,
          brand: p.data.brand,
          shortDescription: p.data.shortDescription,
          featuredImage: p.data.featuredImage,
          affiliateUrl: p.data.affiliateUrl,
        }))} />
      </div>
    </section>
  )}

  {allBrands.length > 0 && (
    <section class="home-section">
      <div class="container">
        <div class="section-heading">
          <h2>Featured Brands</h2>
          <a href="/brands/">All brands &rarr;</a>
        </div>
        <div class="category-grid">
          {allBrands.slice(0, 4).map((b) => (
            <a href={`/brands/${b.slug}/`} class="category-card">
              <div class="category-card-label">{b.data.name}</div>
            </a>
          ))}
        </div>
      </div>
    </section>
  )}

  <section class="home-section">
    <div class="container">
      <h2>About Building Products Info</h2>
      <p style="max-width:42rem;margin-top:0.75rem;">
        We provide independent, detailed product information for the UK building and trade industry.
        Our aim is to help professionals and serious DIYers make informed purchasing decisions by
        presenting clear specifications, key features, and honest assessments of building products
        across all major categories.
      </p>
    </div>
  </section>
</BaseLayout>
