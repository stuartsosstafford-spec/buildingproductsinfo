---
import BaseLayout from '@/layouts/BaseLayout.astro';
import ProductGrid from '@/components/ProductGrid.astro';
import Breadcrumbs from '@/components/Breadcrumbs.astro';
import SchemaOrg from '@/components/SchemaOrg.astro';
import CategoryNav from '@/components/CategoryNav.astro';
import { getCollection } from 'astro:content';
import { buildCanonical } from '@/lib/seo';
import { itemListSchema } from '@/lib/schema';

const categorySlug = 'tools';
const categoryLabel = 'Tools';

const products = await getCollection('products', ({ data }) => !data.draft && data.category === categorySlug);
products.sort((a, b) => b.data.addedDate.getTime() - a.data.addedDate.getTime());

const breadcrumbs = [
  { name: categoryLabel, url: buildCanonical(`/${categorySlug}/`) },
];

const listSchema = itemListSchema(categoryLabel, products.map((p) => ({
  name: p.data.title,
  url: buildCanonical(`/${categorySlug}/${p.slug}/`),
})));
---
<BaseLayout
  title={categoryLabel}
  description={`Browse ${categoryLabel.toLowerCase()} products â€” specifications, key features, and buying information for trade professionals and DIYers.`}
>
  <SchemaOrg schema={listSchema} slot="head" />
  <div class="container">
    <Breadcrumbs items={breadcrumbs} />

    <h1>{categoryLabel}</h1>
    <p style="margin-bottom:2rem;color:var(--color-text-light);">
      Browse our range of {categoryLabel.toLowerCase()} products with full specifications, key features, and independent product information.
    </p>

    {products.length > 0 ? (
      <ProductGrid products={products.map((p) => ({
        title: p.data.title,
        slug: p.slug,
        category: p.data.category,
        brand: p.data.brand,
        shortDescription: p.data.shortDescription,
        featuredImage: p.data.featuredImage,
        affiliateUrl: p.data.affiliateUrl,
      }))} />
    ) : (
      <p>No products in this category yet. Check back soon.</p>
    )}
  </div>
</BaseLayout>
